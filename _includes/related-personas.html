{% if page.personas and page.personas.size > 0 %}
<section class="margin-top-4">
    <h2>Personas</h2>
    <div class="personas-buttons" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
        {% for persona_ref in page.personas %}
        {% assign persona_page = nil %}
        {% assign ref_lc = persona_ref | downcase %}
        {% for candidate in site.personas %}
            {% assign cand_slug = candidate.slug | default: '' | downcase %}
            {% assign cand_basename = candidate.basename | default: '' | downcase %}
            {% assign cand_title = candidate.title | default: '' | downcase %}
            {% if cand_slug == ref_lc or cand_basename == ref_lc or cand_title == ref_lc %}
                {% assign persona_page = candidate %}
                {% break %}
            {% endif %}
        {% endfor %}

        {% if persona_page %}
        <div style="display:flex; align-items:center; gap:0.5rem; width:100%; margin-bottom:0.5rem;">
          <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ‘¤</span>
          <a href="{{ persona_page.url  | relative_url }}" class="usa-link" style="flex: 1;">{{ persona_page.title }}</a>
        </div>
        {% else %}
        <div style="display:flex; align-items:center; gap:0.5rem; width:100%; margin-bottom:0.5rem;">
          <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ‘¤</span>
          <a href="#" class="usa-link" style="flex: 1;">{{ persona_ref }}</a>
        </div>
        {% endif %}
        {% endfor %}
    </div>
</section>
{% else %}
  {%- comment -%} If this page doesn't explicitly list personas, see if any persona pages reference this page (common for use_case pages). {%- endcomment -%}
  {% assign has_personas = false %}
  {% for p in site.personas %}
    {% if p.use_cases %}
      {% for uc in p.use_cases %}
        {% if uc == page.slug or uc == page.basename or uc == page.title %}
          {% assign has_personas = true %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}

  {% if has_personas %}
    <section class="margin-top-2">
      <h2>Related personas</h2>
      <ul class="usa-list" style="list-style: none; margin: 0; padding-left: 0;">
        {% for p in site.personas %}
          {% if p.use_cases %}
            {% for uc in p.use_cases %}
              {% if uc == page.slug or uc == page.basename or uc == page.title %}
                <li style="display:flex; align-items:center; gap:0.5rem;">
                  <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ‘¤</span>
                  <a href="{{ p.url | relative_url }}" class="usa-link">{{ p.title }}</a>
                </li>
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endif %}
