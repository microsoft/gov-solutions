{% comment %} Show explicit requires list if provided, otherwise find app starter kits that reference this page (match against use_cases, data_models, personas fields) and show links. {% endcomment %}

{% if page.requires and page.requires.size > 0 %}
  <section class="margin-top-4">
    <h3>Requires app starter kits</h3>
    <ul class="usa-list" style="list-style: none; margin: 0; padding-left: 0;">
      {% for req in page.requires %}
        {% assign sk_item = nil %}
        {% assign req_lc = req | downcase %}
        {% for candidate in site.app_starter_kits %}
          {% assign cand_slug = candidate.slug | default: '' | downcase %}
          {% assign cand_basename = candidate.basename | default: '' | downcase %}
          {% assign cand_title = candidate.title | default: '' | downcase %}
          {% if cand_slug == req_lc or cand_basename == req_lc or cand_title == req_lc %}
            {% assign sk_item = candidate %}
            {% break %}
          {% endif %}
        {% endfor %}
        {% if sk_item %}
          <li style="display:flex; align-items:center; gap:0.5rem;">
            <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ§°</span>
            <a href="{{ sk_item.url | relative_url }}" class="usa-link">{{ sk_item.title }}</a>
          </li>
        {% else %}
          <li style="display:flex; align-items:center; gap:0.5rem;">
            <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ§°</span>
            <span>{{ req }}</span>
          </li>
        {% endif %}
      {% endfor %}
    </ul>
  </section>

{% else %}
  {% comment %} Find app starter kits that reference this page (match against use_cases, data_models, personas fields) and show links. {% endcomment %}

  {% assign has_related = false %}
  {% for s in site.app_starter_kits %}
    {% assign matched = false %}
    {% if s.use_cases %}
      {% for ref in s.use_cases %}
        {% if ref == page.title or ref == page.slug or ref == page.basename %}
          {% assign matched = true %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
    {% if s.data_models and matched == false %}
      {% for ref in s.data_models %}
        {% if ref == page.title or ref == page.slug or ref == page.basename %}
          {% assign matched = true %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
    {% if s.personas and matched == false %}
      {% for ref in s.personas %}
        {% if ref == page.title or ref == page.slug or ref == page.basename %}
          {% assign matched = true %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
    {% if matched %}
      {% assign has_related = true %}
      {% break %}
    {% endif %}
  {% endfor %}

  {% if has_related %}
    <section class="margin-top-4">
      <h3>Related app starter kits</h3>
      <ul class="usa-list" style="list-style: none; margin: 0; padding-left: 0;">
        {% for s in site.app_starter_kits %}
          {% assign matched = false %}
          {% if s.use_cases %}
            {% for ref in s.use_cases %}
              {% if ref == page.title or ref == page.slug or ref == page.basename %}
                {% assign matched = true %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if s.data_models and matched == false %}
            {% for ref in s.data_models %}
              {% if ref == page.title or ref == page.slug or ref == page.basename %}
                {% assign matched = true %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if s.personas and matched == false %}
            {% for ref in s.personas %}
              {% if ref == page.title or ref == page.slug or ref == page.basename %}
                {% assign matched = true %}
                {% break %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if matched %}
            <li style="display:flex; align-items:center; gap:0.5rem;">
              <span aria-hidden="true" style="display:inline-block; width:1.25rem; text-align:center;">ðŸ§°</span>
              <a href="{{ s.url | relative_url }}" class="usa-link">{{ s.title }}</a>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    </section>
  {% endif %}
{% endif %}
